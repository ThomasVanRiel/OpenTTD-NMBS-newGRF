/*
 *  Copyright (C) 2014 Transportman
 *  This file is part of the 2cc Trains In NML
 *  This program is free software; you can redistribute it and/or modify it under the terms of the GNU General Public License as published by the Free Software Foundation; either version 2 of the License, or (at your option) any later version.
 *  This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for more details.
 *  You should have received a copy of the GNU General Public License along with this program; if not, write to the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
*/

//	============================================================================
//	VEHICLE SPRITES
//	============================================================================

//Front
spriteset(spriteset_COACH_MU_I11_COACH_REAR_front, "gfx/Coaches/COACH_MU_I11_COACH_REAR.PNG") {
	template_2cc_engines_general(1, 1)
}

//Back
spriteset(spriteset_COACH_MU_I11_COACH_REAR_back, "gfx/Coaches/COACH_MU_I11_COACH_REAR.PNG") {
	template_2cc_engines_general(1, 32)
}

//Middle - PAX - Part 2 regular
spriteset(spriteset_COACH_MU_I11_COACH_REAR_middlepass_regular, "gfx/Coaches/COACH_MU_I11_COACH_REAR.PNG") {
	template_2cc_engines_general(1, 64)
}

//Middle - PAX - Part 2 Front
spriteset(spriteset_COACH_MU_I11_COACH_REAR_middlepass_part2_front, "gfx/Coaches/COACH_MU_I11_COACH_REAR.PNG") {
	template_2cc_engines_general(1, 96)
}

//Middle - PAX - Part 2 Back
spriteset(spriteset_COACH_MU_I11_COACH_REAR_middlepass_part2_back, "gfx/Coaches/COACH_MU_I11_COACH_REAR.PNG") {
	template_2cc_engines_general(1, 128)
}

//Middle - PAX - Double
spriteset(spriteset_COACH_MU_I11_COACH_REAR_middlepass_double, "gfx/Coaches/COACH_MU_I11_COACH_REAR.PNG") {
	template_2cc_engines_general(1, 160)
}

switch(FEAT_TRAINS, SELF, switch_COACH_MU_I11_COACH_REAR_middlepass_position_back, [STORE_TEMP(1, 0x10F), var[0x61, 0, 0x0000FFFF, 0xC6]]) {
	ID_RANGE_UNIT_WAGONS: spriteset_COACH_MU_I11_COACH_REAR_middlepass_regular;
	spriteset_COACH_MU_I11_COACH_REAR_middlepass_part2_back;
}

switch(FEAT_TRAINS, SELF, switch_COACH_MU_I11_COACH_REAR_middlepass_position_front, [STORE_TEMP(1, 0x10F), var[0x61, 0, 0x0000FFFF, 0xC6]]) {
	ID_RANGE_UNIT_WAGONS: spriteset_COACH_MU_I11_COACH_REAR_middlepass_part2_front;
	spriteset_COACH_MU_I11_COACH_REAR_middlepass_double;
}

switch(FEAT_TRAINS, SELF, switch_COACH_MU_I11_COACH_REAR_middlepass_length, [STORE_TEMP(-1, 0x10F), var[0x61, 0, 0x0000FFFF, 0xC6]]) {
	ID_RANGE_UNIT_WAGONS: switch_COACH_MU_I11_COACH_REAR_middlepass_position_back;
	switch_COACH_MU_I11_COACH_REAR_middlepass_position_front;
}

//Middle - MAIL - Part 2 regular
spriteset(spriteset_COACH_MU_I11_COACH_REAR_middlemail_regular, "gfx/Coaches/COACH_MU_I11_COACH_REAR.PNG") {
	template_2cc_engines_general(1, 192)
}

//Middle - MAIL - Part 2 Front
spriteset(spriteset_COACH_MU_I11_COACH_REAR_middlemail_part2_front, "gfx/Coaches/COACH_MU_I11_COACH_REAR.PNG") {
	template_2cc_engines_general(1, 224)
}

//Middle - MAIL - Part 2 Back
spriteset(spriteset_COACH_MU_I11_COACH_REAR_middlemail_part2_back, "gfx/Coaches/COACH_MU_I11_COACH_REAR.PNG") {
	template_2cc_engines_general(1, 256)
}

//Middle - MAIL - Double
spriteset(spriteset_COACH_MU_I11_COACH_REAR_middlemail_double, "gfx/Coaches/COACH_MU_I11_COACH_REAR.PNG") {
	template_2cc_engines_general(1, 288)
}

switch(FEAT_TRAINS, SELF, switch_COACH_MU_I11_COACH_REAR_middlemail_position_back, [STORE_TEMP(1, 0x10F), var[0x61, 0, 0x0000FFFF, 0xC6]]) {
	ID_RANGE_UNIT_WAGONS: spriteset_COACH_MU_I11_COACH_REAR_middlemail_regular;
	spriteset_COACH_MU_I11_COACH_REAR_middlemail_part2_back;
}

switch(FEAT_TRAINS, SELF, switch_COACH_MU_I11_COACH_REAR_middlemail_position_front, [STORE_TEMP(1, 0x10F), var[0x61, 0, 0x0000FFFF, 0xC6]]) {
	ID_RANGE_UNIT_WAGONS: spriteset_COACH_MU_I11_COACH_REAR_middlemail_part2_front;
	spriteset_COACH_MU_I11_COACH_REAR_middlemail_double;
}

switch(FEAT_TRAINS, SELF, switch_COACH_MU_I11_COACH_REAR_middlemail_length, [STORE_TEMP(-1, 0x10F), var[0x61, 0, 0x0000FFFF, 0xC6]]) {
	ID_RANGE_UNIT_WAGONS: switch_COACH_MU_I11_COACH_REAR_middlemail_position_back;
	switch_COACH_MU_I11_COACH_REAR_middlemail_position_front;
}

//Dualheaded engines
switch(FEAT_TRAINS, SELF, switch_COACH_MU_I11_COACH_REAR_reversed, var[0xC8]) {
	0xFE: spriteset_COACH_MU_I11_COACH_REAR_back;
    0xFF: spriteset_COACH_MU_I11_COACH_REAR_back; 
    spriteset_COACH_MU_I11_COACH_REAR_front;
}

//Visual effect, for EMU this is done on the part with the pantograph
switch(FEAT_TRAINS, SELF, switch_COACH_MU_I11_COACH_REAR_visual_effect_and_powered, var[0xC8]) {
	0xFE: visual_effect_and_powered(VISUAL_EFFECT_ELECTRIC, -3, DISABLE_WAGON_POWER);
	0xFF: visual_effect_and_powered(VISUAL_EFFECT_ELECTRIC, -3, DISABLE_WAGON_POWER);
	visual_effect_and_powered(VISUAL_EFFECT_DISABLE, 0, DISABLE_WAGON_POWER);
}

//	============================================================================
//	PURCHASE SPRITE
//	============================================================================

spriteset(spriteset_COACH_MU_I11_COACH_REAR_purchase, "gfx/Coaches/COACH_MU_I11_COACH_REAR.PNG") {
	template_purchase_dualheaded(1, 320)
}
	
//	============================================================================
//	CARGO CAPACITY
//	============================================================================

switch(FEAT_TRAINS, SELF, switch_COACH_MU_I11_COACH_REAR_capacity, cargo_classes) {
	bitmask(CC_MAIL): 		40;
	bitmask(CC_ARMOURED): 	30;
							80;
}

//Graphics for the unit wagon based on cargo class
switch(FEAT_TRAINS, SELF, 	switch_COACH_MU_I11_COACH_REAR_cargo_selection, cargo_classes){
	bitmask(CC_PASSENGERS): switch_COACH_MU_I11_COACH_REAR_middlepass_length;
							switch_COACH_MU_I11_COACH_REAR_middlemail_length;
}

//	============================================================================
//	ITEM CODE
//	============================================================================

item(FEAT_TRAINS, ITEM_COACH_MU_I11_COACH_REAR) {
    property {
        name: 							string(STR_NAME_COACH_MU_I11_COACH_REAR);
        climates_available: 			ALL_CLIMATES;
		
        introduction_date: 				date(1995,1,1);
        model_life: 					VEHICLE_NEVER_EXPIRES;
        vehicle_life: 					25;		

        track_type: 					RAIL;
		ai_special_flag: 				AI_FLAG_PASSENGER;
        engine_class: 					ENGINE_CLASS_ELECTRIC;
	
		running_cost_base: 				RUNNING_COST_ELECTRIC;
        cost_factor: 					21;
        running_cost_factor: 			66;
		
        speed: 							201 km/h;
        power: 							0 hp;
        weight: 						46 tons;
        tractive_effort_coefficient:	0;
        air_drag_coefficient: 			0;
        reliability_decay: 20;

        CARGODEF_PASSENGERS
        LOADINGSPEEDDEF_INTERCITY
		cargo_capacity: 				80;
        cargo_age_period: 				185;
        refit_cost: 					0;

        //misc_flags:					bitmask(TRAIN_FLAG_MU,TRAIN_FLAG_2CC);
        visual_effect_and_powered:		visual_effect_and_powered(VISUAL_EFFECT_DISABLE, 0, DISABLE_WAGON_POWER);

        sprite_id: 						SPRITE_ID_NEW_TRAIN;
        dual_headed: 					1;
        length: 						8;
        extra_power_per_wagon: 			0;
        bitmask_vehicle_info: 			0;
	}
	
//	============================================================================
//	GRAPHICS SWITCHES
//	============================================================================

	graphics {
		purchase: 						spriteset_COACH_MU_I11_COACH_REAR_purchase;
		additional_text: 				string(STR_TEXT_COACH_MU_I11_COACH_REAR);
		cargo_capacity: 				switch_COACH_MU_I11_COACH_REAR_capacity;
		visual_effect_and_powered:		switch_COACH_MU_I11_COACH_REAR_visual_effect_and_powered;
		can_attach_wagon: 				switch_can_attach_vehicle;
										switch_COACH_MU_I11_COACH_REAR_reversed;
	}
	
//	============================================================================
//	LIVERY OVERRIDES
//	============================================================================

	livery_override (ITEM_SPECIAL_MU_WAGON_UNPOWERED){
		LOADINGSPEEDDEF_INTERCITY
		running_cost_factor: 			15;
		power: 							0;
		weight: 						46;
		cargo_capacity:					switch_COACH_MU_I11_COACH_REAR_capacity;
		length: 						8;
		default: 						switch_COACH_MU_I11_COACH_REAR_cargo_selection;
	}
	livery_override (ITEM_SPECIAL_MU_WAGON_POWERED){
		LOADINGSPEEDDEF_INTERCITY
		running_cost_factor: 			15;
		power: 							0;
		weight: 						46;
		cargo_capacity: 				switch_COACH_MU_I11_COACH_REAR_capacity;
        tractive_effort_coefficient: 	0;
		length: 						8;
		default:						switch_COACH_MU_I11_COACH_REAR_cargo_selection;
	}
}
